<style>.boldtitle{font-weight:600;}.padleft{padding-left:20px;}.vcenter{vertical-align: middle;}.trpadbottom{padding-bottom:5px;}</style>
[% pagetitle = 'PLUGIN_DYNAMICPLAYLISTS3' | string; pageicon = 'PLUGIN_DYNAMICPLAYLISTS3' %]

[% pwd_list = BLOCK %]/
	<a href="[% webroot %]plugins/DynamicPlaylists3/dynamicplaylist_list.html?player=[% player | uri %]">
		[% "PLUGIN_DYNAMICPLAYLISTS3" | string %]
	</a>
[% END %]
[% PROCESS pageheader.html %]

[% BLOCK href %]
href="[% webroot %]plugins/DynamicPlaylists3/dynamicplaylist_mixparameters.html?type=[% type %]&amp;player=[% player | uri %]"
		 onclick='document.editForm.type.value = "[% type %]";
							document.editForm.submit();
							return false;'
[% END %]

<br><p>[% "PLUGIN_DYNAMICPLAYLISTS3_PARAMETERS_TITLE" | string %]: <span class="boldtitle">[% pluginDynamicPlaylists3Playlist.name | html %]</span></p><br>
<form action="[% webroot %]plugins/DynamicPlaylists3/dynamicplaylist_mixparameters.html" name="editForm" accept-charset="iso8859-1">
	<input type="hidden" name="type" value="[% pluginDynamicPlaylists3PlaylistId %]">
	<input type="hidden" name="addOnly" value="[% pluginDynamicPlaylists3AddOnly %]">

[% FOREACH param IN pluginDynamicPlaylists3MixParameters %]
	[% IF param.parameter.type == "multiplegenres" || param.parameter.type == "multipledecades" || param.parameter.type == "multipleyears" || param.parameter.type == "multiplestaticplaylists" %]
	<span class="boldtitle">[% param.parameter.name %]:</span><br>
		[% IF param.parameter.type == "multiplegenres" %]
		<table border="0" width="100%">[% USE table genrelistsorted, cols=3, pad=0 %]
			[% FOREACH genrerow = table.rows %]
				<tr class="">
					[% FOREACH genre = genrerow %]
					[% genreid = genrelist.item("$genre").id %]
					<td>
						<input type="checkbox" name="[% genreid %]" id="[% genreid %]" [% genrelist.item("$genre").selected ? "checked" : "" %] onclick="changeNumSelected(this)" [% IF currentparam != "multiplegenres" %]disabled[% END %]>
						<label style="font-weight: normal;" for="[% genreid %]">[% genrelist.item("$genre").name | html %]</label>
					</td>
					[% END %]
				</tr>
			<tr>&nbsp;&nbsp;</tr><tr>&nbsp;&nbsp;</tr>
			[% END %]
			<input type="hidden" id="dynamicplaylist_parameter_[% param.parameter.id %]" name="dynamicplaylist_parameter_[% param.parameter.id %]" value="[% param.value %]">
		</table>
		[% END %]
		[% IF param.parameter.type == "multipledecades" %]
		<table border="0" width="100%">[% USE table decadelistsorted, cols=3, pad=0 %]
			[% FOREACH decaderow = table.rows %]
				<tr class="">
					[% FOREACH decade = decaderow %]
					[% decadeid = decadelist.item("$decade").id %]
					<td>
						<input type="checkbox" name="[% decadeid %]" id="[% decadeid %]" [% decadelist.item("$decade").selected ? "checked" : "" %] onclick="changeNumSelected(this)" [% IF currentparam != "multipledecades" %]disabled[% END %]>
						<label style="font-weight: normal;" for="[% decadeid %]">[% decadelist.item("$decade").name | html %]</label>
					</td>
					[% END %]
				</tr>
			<tr>&nbsp;&nbsp;</tr><tr>&nbsp;&nbsp;</tr>
			[% END %]
			<input type="hidden" id="dynamicplaylist_parameter_[% param.parameter.id %]" name="dynamicplaylist_parameter_[% param.parameter.id %]" value="[% param.value %]">
		</table>
		[% END %]
		[% IF param.parameter.type == "multipleyears" %]
		<table border="0" width="100%">[% USE table yearlistsorted, cols=3, pad=0 %]
			[% FOREACH yearrow = table.rows %]
				<tr class="">
					[% FOREACH year = yearrow %]
					[% yearid = yearlist.item("$year").id %]
					<td>
						<input type="checkbox" name="[% yearid %]" id="[% yearid %]" [% yearlist.item("$year").selected ? "checked" : "" %] onclick="changeNumSelected(this)" [% IF currentparam != "multipleyears" %]disabled[% END %]>
						<label style="font-weight: normal;" for="[% yearid %]">[% yearlist.item("$year").name | html %]</label>
					</td>
					[% END %]
				</tr>
			<tr>&nbsp;&nbsp;</tr><tr>&nbsp;&nbsp;</tr>
			[% END %]
			<input type="hidden" id="dynamicplaylist_parameter_[% param.parameter.id %]" name="dynamicplaylist_parameter_[% param.parameter.id %]" value="[% param.value %]">
		</table>
		[% END %]
		[% IF param.parameter.type == "multiplestaticplaylists" %]
		<table border="0" width="100%">[% USE table staticplaylistlistsorted, cols=1, pad=0 %]
			[% FOREACH staticplaylistrow = table.rows %]
				<tr class="">
					[% FOREACH staticplaylist = staticplaylistrow %]
					[% staticplaylistid = staticplaylistlist.item("$staticplaylist").id %]
					<td>
						<input type="checkbox" name="[% staticplaylistid %]" id="[% staticplaylistid %]" [% staticplaylistlist.item("$staticplaylist").selected ? "checked" : "" %] onclick="changeNumSelected(this)" [% IF currentparam != "multiplestaticplaylists" %]disabled[% END %]>
						<label style="font-weight: normal;" for="[% staticplaylistid %]">[% staticplaylistlist.item("$staticplaylist").name | html %]</label>
					</td>
					[% END %]
				</tr>
			<tr>&nbsp;&nbsp;</tr><tr>&nbsp;&nbsp;</tr>
			[% END %]
			<input type="hidden" id="dynamicplaylist_parameter_[% param.parameter.id %]" name="dynamicplaylist_parameter_[% param.parameter.id %]" value="[% param.value %]">
		</table>
		[% END %]
	<br>

	[% ELSE %]
	<table border="0">
		<tr>
		<td class="vcenter">[% param.parameter.name %]</td>
		<td>&nbsp;</td>
		<td>
			<select name="dynamicplaylist_parameter_[% param.parameter.id %]">
			[% FOREACH value = param.values %]
				<option onClick='document.editForm.submit();return false;' value="[% value.id %]" [% IF param.value == value.id %]selected="selected"[% END %]>[% value.name | html %]</option>
			[% END %]
			</select>
		</td>
		</tr>
	</table>
	<br>
	[% END %]
[% END %]

	<script type="text/javascript">
		var f = document.editForm;
		var selectedItems = [];
		var numSelected = 0;
		var numCheckBoxes = 0;
		var selectAllString = '[% "PLUGIN_DYNAMICPLAYLISTS3_SELECT_ALL" | string %]';
		var selectNoneString = '[% "PLUGIN_DYNAMICPLAYLISTS3_SELECT_NONE" | string %]';

		// get number of checkboxes
		for (var i=0; i < f.elements.length; i++) {
			if (f.elements[i].type == 'checkbox') {
				numCheckBoxes++;
			}
		}

		// select all or none
		function selectAll() {
			var newState = numSelected != numCheckBoxes;

			for (var i=0; i < f.elements.length; i++) {
				if (f.elements[i].type == 'checkbox') {
					f.elements[i].checked = newState;
				}
			}
			if (newState) { // if numSelected < numCheckBoxes => select all
				numSelected = numCheckBoxes;
				f.selectAllButton.value = selectNoneString;
				for (var i=0; i < f.elements.length; i++) {
					if (f.elements[i].type == 'checkbox') {
						if(!selectedItems.some(el => el === f.elements[i].id)) selectedItems.push(f.elements[i].id);
					}
				}
			} else { // if numSelected = numCheckBoxes => select none
				numSelected = 0;
				f.selectAllButton.value = selectAllString;
				for (var i=0; i < f.elements.length; i++) {
					if (f.elements[i].type == 'checkbox') {
						selectedItems = selectedItems.filter(function(item) {
							return item !== f.elements[i].id
						});
					}
				}
			}
			document.getElementById("dynamicplaylist_parameter_[% param.parameter.id %]").value = selectedItems;
		}

		// increase/decrease numSelected every time a checkbox changes
		function changeNumSelected(checkBox) {
			if (checkBox.checked) {
				numSelected++;
				if(!selectedItems.some(el => el === f.elements[i].id)) selectedItems.push(checkBox.id);
			} else {
				numSelected--;
				selectedItems = selectedItems.filter(function(item) {
					return item !== checkBox.id
				});
			}
			document.getElementById("dynamicplaylist_parameter_[% param.parameter.id %]").value = selectedItems;

			if (numSelected == numCheckBoxes) {
				f.selectAllButton.value = selectNoneString;
			} else {
				f.selectAllButton.value = selectAllString;
			}
		}
	</script>
	<br>
[% IF lastparameter && addOnly == 99 %]
	<table border="0">
		<tr>
		<td class="vcenter">[% "PLUGIN_DYNAMICPLAYLISTS3_CUSTOMFAVTITLE" | string %]</td>
		<td>&nbsp;&nbsp;</td>
		<td>
			<input type="text" id="dpl_customfavtitle" name="dpl_customfavtitle" value="[% pluginDynamicPlaylists3Playlist.name | html %]" size="40">
		</td>
		</tr>
		<tr><td>&nbsp;</td></tr>
		<tr>
		<td class="vcenter">[% "PLUGIN_DYNAMICPLAYLISTS3_FAVADDONLY" | string %]</td>
		<td>&nbsp;&nbsp;</td>
		<td>
			<input type="checkbox" id="dpl_favaddonly" name="dpl_favaddonly" value="0" onclick="this.value=1">
		</td>
		</tr>
	</table>
	<br>
[% END %]
	<input type="submit" value="[% IF lastparameter %][% IF addOnly == 1 %][% "PLUGIN_DYNAMICPLAYLISTS3_ADD" | string %][% ELSIF addOnly == 99 %][% "PLUGIN_DYNAMICPLAYLISTS3_ADDTOLMSFAVORITES_BTN" | string %][% ELSE %][% "PLUGIN_DYNAMICPLAYLISTS3_PLAY" | string %][% END %][% ELSE %][% "PLUGIN_DYNAMICPLAYLISTS3_NEXT" | string %][% END %]">
[% IF param.parameter.type == "multiplegenres" || param.parameter.type == "multipledecades" || param.parameter.type == "multipleyears" || param.parameter.type == "multiplestaticplaylists" %]
	<script type="text/javascript">
		document.write('<span class="padleft"><input type="button" value="' + (numSelected == numCheckBoxes ? selectNoneString : selectAllString) + '" id="selectAllButton" onclick="selectAll()"></span>');
	</script>
[% END %]
</form>
<br>
[% PROCESS pagefooter.html %]
